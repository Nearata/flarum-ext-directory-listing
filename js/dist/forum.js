(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";function e(t,r){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},e(t,r)}function a(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,e(t,r)}t.r(r);const o=flarum.core.compat["forum/app"];var n=t.n(o),i=function(){function t(){this.loading=void 0,this.data=void 0,this.loading=!0,this.data=[]}var r=t.prototype;return r.isLoading=function(){return this.loading},r.loadData=function(){var t=this;this.data=[],this.loading=!0;var r=m.route.param("path");r||(r=""),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/nearata/directoryListing",body:{path:r}}).then((function(r){t.data=r.data,t.loading=!1,m.redraw()})).catch((function(){t.loading=!1,m.redraw()}))},r.getData=function(){return this.data},t}();const c=flarum.core.compat["common/Component"];var s=t.n(c);const l=flarum.core.compat["common/components/Link"];var u=t.n(l);const p=flarum.core.compat["common/helpers/icon"];var d=t.n(p),f=function(t){function r(){return t.apply(this,arguments)||this}a(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r)},e.oncreate=function(r){t.prototype.oncreate.call(this,r)},e.view=function(){var t=m.route.param().path;if(t){var r=t.split("/");r.pop();var e=n().route("nearataDirectoryListing",{path:r.join()});return m(u(),{class:"DirectoryTreeBackItem",href:e},m("div",{class:"icon"},d()("fas fa-level-up-alt")),m("div",null,".."))}},r}(s()),h=function(t){function r(){return t.apply(this,arguments)||this}a(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r)},e.oncreate=function(r){t.prototype.oncreate.call(this,r);for(var e=this.element.querySelectorAll(".item"),a=0;a<e.length-1;a++){var o=document.createElement("div");o.classList.add("separator"),o.innerHTML="/",e[a].after(o)}},e.view=function(){var t=m.route.param("path"),r="";return m("div",{class:"DirectoryTreeBreadcrumb"},m(u(),{class:"item",href:n().route("nearataDirectoryListing")},n().translator.trans("nearata-directory-listing.forum.breadcrumb_home_label")),t&&t.split("/").map((function(t,e,a){return r+=e>0?"/"+t:t,m(u(),{class:"item",href:n().route("nearataDirectoryListing",{path:r})},t)})))},r}(s());const y=flarum.core.compat["common/helpers/humanTime"];var v=t.n(y);function g(){return g=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},g.apply(this,arguments)}var b=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],D=["B","kiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],x=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],B=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],L=function(t,r,e){var a=t;return"string"==typeof r||Array.isArray(r)?a=t.toLocaleString(r,e):!0!==r&&void 0===e||(a=t.toLocaleString(void 0,e)),a},S=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(r=t.call.apply(t,[this].concat(a))||this).data=void 0,r.external=void 0,r.externalHref=void 0,r}a(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.data=this.attrs.data,this.external="dir"!==this.data.type,this.externalHref=this.external&&location.origin+"/assets/nearataDirectoryListing/"+this.data.path},e.oncreate=function(r){t.prototype.oncreate.call(this,r)},e.view=function(){return m(u(),{class:"DirectoryTreeItem",external:this.external,href:this.external?this.externalHref:n().route("nearataDirectoryListing",{path:this.data.path})},m("div",{class:"icon"},this.external?d()("fas fa-file"):d()("fas fa-folder")),m("div",{class:"fileName"},this.data.filename,this.data.extension&&"."+this.data.extension),m("div",{class:"size"},this.data.size?function(t,r){if(!Number.isFinite(t))throw new TypeError("Expected a finite number, got "+typeof t+": "+t);var e=(r=g({bits:!1,binary:!1,space:!0},r)).bits?r.binary?B:x:r.binary?D:b,a=r.space?" ":"";if(r.signed&&0===t)return" 0"+a+e[0];var o,n=t<0,i=n?"-":r.signed?"+":"";if(n&&(t=-t),void 0!==r.minimumFractionDigits&&(o={minimumFractionDigits:r.minimumFractionDigits}),void 0!==r.maximumFractionDigits&&(o=g({maximumFractionDigits:r.maximumFractionDigits},o)),t<1)return i+L(t,r.locale,o)+a+e[0];var c=Math.min(Math.floor(r.binary?Math.log(t)/Math.log(1024):Math.log10(t)/3),e.length-1);return t/=Math.pow(r.binary?1024:1e3,c),o||(t=t.toPrecision(3)),i+L(Number(t),r.locale,o)+a+e[c]}(this.data.size):"-"),m("div",{class:"date"},v()(window.dayjs.unix(this.data.timestamp).toISOString())))},r}(s());const w=flarum.core.compat["common/components/LoadingIndicator"];var P=t.n(w);const T=flarum.core.compat["common/components/Placeholder"];var _=t.n(T),O=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(r=t.call.apply(t,[this].concat(a))||this).directoryState=void 0,r}a(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.directoryState=this.attrs.state,this.directoryState.loadData()},e.oncreate=function(r){t.prototype.oncreate.call(this,r)},e.view=function(){var t=n().translator.trans("nearata-directory-listing.forum.placeholder_empty_folder_text");return m("div",{class:"DirectoryTree"},m(h,null),m(f,null),this.directoryState.isLoading()&&m(P(),null),this.directoryState.isLoading()||!this.directoryState.getData().length&&m(_(),{text:t}),m("div",{class:"DirectoryTreeList"},this.directoryState.getData().map((function(t){return m(S,{data:t})}))))},r}(s());const M=flarum.core.compat["common/components/Button"];var I=t.n(M);const j=flarum.core.compat["common/components/Page"];var N=t.n(j);const k=flarum.core.compat["common/helpers/listItems"];var A=t.n(k);const E=flarum.core.compat["common/utils/ItemList"];var F=t.n(E);const z=flarum.core.compat["common/utils/extractText"];var C=t.n(z);const G=flarum.core.compat["forum/components/IndexPage"];var H=t.n(G),Y=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(r=t.call.apply(t,[this].concat(a))||this).directoryState=void 0,r}a(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.directoryState=new i},e.oncreate=function(r){t.prototype.oncreate.call(this,r),n().setTitle(C()(n().translator.trans("nearata-directory-listing.forum.page_title"))),n().setTitleCount(0)},e.actionItems=function(){var t=this,r=new(F());return r.add("refresh",I().component({title:n().translator.trans("nearata-directory-listing.forum.refresh_action_button_label"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){return t.directoryState.loadData()}})),r},e.view=function(){return m("div",{className:"NearataDirectoryListing"},H().prototype.hero(),m("div",{className:"container"},m("div",{class:"sideNavContainer"},m("nav",{class:"IndexPage-nav sideNav"},m("ul",null,A()(H().prototype.sidebarItems().toArray()))),m("div",{class:"IndexPage-results sideNavOffset"},m("div",{className:"DirectoryListingPage-toolbar"},m("ul",{className:"action"},A()(this.actionItems().toArray()))),m(O,{state:this.directoryState})))))},r}(N());const Z=flarum.core.compat["common/resolvers/DefaultResolver"];var q=function(t){function r(){return t.apply(this,arguments)||this}return a(r,t),r.prototype.makeKey=function(){var t=m.route.param("path");return t||(t=""),t},r}(t.n(Z)());const K=flarum.core.compat["common/components/LinkButton"];var R=t.n(K);const U=flarum.core.compat["common/extend"];n().initializers.add("nearata-directory-listing",(function(){n().routes.nearataDirectoryListing={path:"/directoryListing",component:Y,resolverClass:q},(0,U.extend)(H().prototype,"navItems",(function(t){t.add("nearataDirectoryListing",m(R(),{icon:"fas fa-folder",href:n().route("nearataDirectoryListing")},n().translator.trans("nearata-directory-listing.forum.page_title")),-1)}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map