(()=>{var t={n:r=>{var a=r&&r.__esModule?()=>r.default:()=>r;return t.d(a,{a}),a},d:(r,a)=>{for(var e in a)t.o(a,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:a[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";function a(t,r){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},a(t,r)}function e(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,a(t,r)}t.r(r);const o=flarum.core.compat["forum/app"];var n=t.n(o),i=function(){function t(){this.loading=void 0,this.data=void 0,this.loading=!0,this.data=[]}var r=t.prototype;return r.isLoading=function(){return this.loading},r.loadData=function(){var t=this;this.data=[],this.loading=!0;var r=m.route.param("path");r||(r=""),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/nearata/directoryListing",body:{path:r}}).then((function(r){t.data=r.data,t.loading=!1,m.redraw()})).catch((function(){t.loading=!1,m.redraw()}))},r.getData=function(){return this.data},t}();const c=flarum.core.compat["common/Component"];var s=t.n(c);const l=flarum.core.compat["common/components/Link"];var u=t.n(l);const p=flarum.core.compat["common/helpers/icon"];var d=t.n(p),f=function(t){function r(){return t.apply(this,arguments)||this}e(r,t);var a=r.prototype;return a.oninit=function(r){t.prototype.oninit.call(this,r)},a.oncreate=function(r){t.prototype.oncreate.call(this,r)},a.view=function(){var t=m.route.param().path;if(t){var r=t.split("/");r.pop();var a=n().route("nearataDirectoryListing",{path:r.join()});return m(u(),{class:"DirectoryTreeBackItem",href:a},m("div",{class:"icon"},d()("fas fa-level-up-alt")),m("div",null,".."))}},r}(s()),h=function(t){function r(){return t.apply(this,arguments)||this}e(r,t);var a=r.prototype;return a.oninit=function(r){t.prototype.oninit.call(this,r)},a.oncreate=function(r){t.prototype.oncreate.call(this,r);for(var a=this.element.querySelectorAll(".item"),e=0;e<a.length-1;e++){var o=document.createElement("div");o.classList.add("separator"),o.innerHTML="/",a[e].after(o)}},a.view=function(){var t=m.route.param("path"),r="";return m("div",{class:"DirectoryTreeBreadcrumb"},m(u(),{class:"item",href:n().route("nearataDirectoryListing")},n().translator.trans("nearata-directory-listing.forum.breadcrumb_home_label")),t&&t.split("/").map((function(t,a,e){return r+=a>0?"/"+t:t,m(u(),{class:"item",href:n().route("nearataDirectoryListing",{path:r})},t)})))},r}(s());const y=flarum.core.compat["common/helpers/humanTime"];var v=t.n(y);function g(){return g=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(t[e]=a[e])}return t},g.apply(this,arguments)}var b=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],D=["B","kiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],x=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],B=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],L=function(t,r,a){var e=t;return"string"==typeof r||Array.isArray(r)?e=t.toLocaleString(r,a):!0!==r&&void 0===a||(e=t.toLocaleString(void 0,a)),e},S=function(t){function r(){for(var r,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).data=void 0,r.external=void 0,r}e(r,t);var a=r.prototype;return a.oninit=function(r){t.prototype.oninit.call(this,r),this.data=this.attrs.data,this.external="dir"!==this.data.type},a.oncreate=function(r){t.prototype.oncreate.call(this,r)},a.view=function(){return m(u(),Object.assign({class:"DirectoryTreeItem",external:this.external,href:this.external?n().forum.attribute("apiUrl")+"/nearata/directoryListing/download?path="+this.data.path:n().route("nearataDirectoryListing",{path:this.data.path})},this.external&&{target:"_blank"}),m("div",{class:"icon"},this.external?d()("fas fa-file"):d()("fas fa-folder")),m("div",{class:"fileName"},this.data.filename,this.data.extension&&"."+this.data.extension),m("div",{class:"size"},this.data.size?function(t,r){if(!Number.isFinite(t))throw new TypeError("Expected a finite number, got "+typeof t+": "+t);var a=(r=g({bits:!1,binary:!1,space:!0},r)).bits?r.binary?B:x:r.binary?D:b,e=r.space?" ":"";if(r.signed&&0===t)return" 0"+e+a[0];var o,n=t<0,i=n?"-":r.signed?"+":"";if(n&&(t=-t),void 0!==r.minimumFractionDigits&&(o={minimumFractionDigits:r.minimumFractionDigits}),void 0!==r.maximumFractionDigits&&(o=g({maximumFractionDigits:r.maximumFractionDigits},o)),t<1)return i+L(t,r.locale,o)+e+a[0];var c=Math.min(Math.floor(r.binary?Math.log(t)/Math.log(1024):Math.log10(t)/3),a.length-1);return t/=Math.pow(r.binary?1024:1e3,c),o||(t=t.toPrecision(3)),i+L(Number(t),r.locale,o)+e+a[c]}(this.data.size):"-"),m("div",{class:"date"},v()(window.dayjs.unix(this.data.timestamp).toISOString())))},r}(s());const w=flarum.core.compat["common/components/LoadingIndicator"];var P=t.n(w);const _=flarum.core.compat["common/components/Placeholder"];var O=t.n(_),T=function(t){function r(){for(var r,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).directoryState=void 0,r}e(r,t);var a=r.prototype;return a.oninit=function(r){t.prototype.oninit.call(this,r),this.directoryState=this.attrs.state,this.directoryState.loadData()},a.oncreate=function(r){t.prototype.oncreate.call(this,r)},a.view=function(){var t=n().translator.trans("nearata-directory-listing.forum.placeholder_empty_folder_text");return m("div",{class:"DirectoryTree"},m(h,null),m(f,null),this.directoryState.isLoading()&&m(P(),null),this.directoryState.isLoading()||!this.directoryState.getData().length&&m(O(),{text:t}),m("div",{class:"DirectoryTreeList"},this.directoryState.getData().map((function(t){return m(S,{data:t})}))))},r}(s());const M=flarum.core.compat["common/components/Button"];var j=t.n(M);const I=flarum.core.compat["common/components/Page"];var N=t.n(I);const k=flarum.core.compat["common/helpers/listItems"];var A=t.n(k);const E=flarum.core.compat["common/utils/ItemList"];var F=t.n(E);const z=flarum.core.compat["common/utils/extractText"];var C=t.n(z);const G=flarum.core.compat["forum/components/IndexPage"];var Y=t.n(G),Z=function(t){function r(){for(var r,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return(r=t.call.apply(t,[this].concat(e))||this).directoryState=void 0,r}e(r,t);var a=r.prototype;return a.oninit=function(r){t.prototype.oninit.call(this,r),this.directoryState=new i},a.oncreate=function(r){t.prototype.oncreate.call(this,r),n().setTitle(C()(n().translator.trans("nearata-directory-listing.forum.page_title"))),n().setTitleCount(0)},a.actionItems=function(){var t=this,r=new(F());return r.add("refresh",j().component({title:n().translator.trans("nearata-directory-listing.forum.refresh_action_button_label"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){return t.directoryState.loadData()}})),r},a.view=function(){return m("div",{className:"NearataDirectoryListing"},Y().prototype.hero(),m("div",{className:"container"},m("div",{class:"sideNavContainer"},m("nav",{class:"IndexPage-nav sideNav"},m("ul",null,A()(Y().prototype.sidebarItems().toArray()))),m("div",{class:"IndexPage-results sideNavOffset"},m("div",{className:"DirectoryListingPage-toolbar"},m("ul",{className:"action"},A()(this.actionItems().toArray()))),m(T,{state:this.directoryState})))))},r}(N());const q=flarum.core.compat["common/resolvers/DefaultResolver"];var U=function(t){function r(){return t.apply(this,arguments)||this}return e(r,t),r.prototype.makeKey=function(){var t=m.route.param("path");return t||(t=""),t},r}(t.n(q)());const H=flarum.core.compat["common/components/LinkButton"];var K=t.n(H);const R=flarum.core.compat["common/extend"];n().initializers.add("nearata-directory-listing",(function(){n().routes.nearataDirectoryListing={path:"/directoryListing",component:Z,resolverClass:U},(0,R.extend)(Y().prototype,"navItems",(function(t){t.add("nearataDirectoryListing",m(K(),{icon:"fas fa-folder",href:n().route("nearataDirectoryListing")},n().translator.trans("nearata-directory-listing.forum.page_title")),-1)}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map